[globals]
[globals]
NET=DAHDI/1
Islas=DAHDI/2
Interfone=DAHDI/5	; Ramal do interfone no escritorio
Fone=DAHDI/5		; Ramal do telefone no escritorio
VOIPL=PJSIP/599		; Intelbras VOIP via SIP LOCAL
VOIPR=PJSIP/5999		; Intelbras VOIP via SIP REMOTO
CelularA=IAX2/60000
;
; tempos de discagem
;
DAHDIDIALTIMEOUT=60
PJSIPDIALTIMEOUT=60
IAXDIALTIMEOUT=60

QUEUETIMEOUT=120		; Timeout a ser usado nas filas de atendimento
			; depois desse tempo as chamadas vao para o voice mail
MBOXFONE=4001
MBOXISLAS=4002

[general]
autofalltrough=yes
callcounter=yes

[default]

exten => s,1,NoOp(Entrando em default)
    same => n,Verbose(,default)
    same => n,Playback(hello-world)
    same => n,Playback(hello-world)
    same => n,Playback(hello-world)
    same => n,Hangup()





;============================================================
[ToBeDefined]
;
; para chamadas nao autenticadas via PJSIP: Buraco Negro
; 2016/jun
;




;============================================================
; sub()	arg1	extension
;	arg2	channel
;	arg3	dial timeout
;
[subRamaisInternos]
exten => start,1,NoOp(Ramal ${ARG1})
    same => n,Set(CHANNEL(language)=br)
    same => n,Verbose(,Chamando Ramal ${ARG1} por ${ARG3}s)
    same => n,Dial(${ARG2},${ARG3})
    same => n,Verbose(,Discagem falhou. Status = ${DIALSTATUS})
    same => n,VoiceMail(${ARG1}@default,u)
    same => n,Hangup()





;============================================================
[Queues]
exten => 7001,1,Verbose(2,${CALLERID(all)} entrando na fila "Interfone")
    same => n,Queue(Interfone,n,,,${QUEUETIMEOUT})
    same => n,VoiceMail(${MBOXISLAS}@default,u)
    same => n,Hangup()

exten => 7002,1,Verbose(2,${CALLERID(all)} entrando na fila "Fixo")
    same => n,Queue(Fixo,n,,,${QUEUETIMEOUT})
    same => n,VoiceMail(${MBOXFONE}@default,u)
    same => n,Hangup()





;============================================================
[RamaisISLAS]
;
; Ramais Islas: 1 para torre A 2 para torre B mais o numero do apartamento
;		11A = 111
;		101A = 1101
;		262A = 2262
;
exten => 044,1,NoOp(Zelador)
    same => n,Verbose(2,Zelador ${EXTEN})
    same => n,SayDigits(${EXTEN})
    same => n,Dial(${Islas}/${EXTEN},20)
    same => n,Hangup()
 
exten => 94,1,NoOp(Portaria)
    same => n,Verbose(,Vai ligar na portaria via ${EXTEN})
    same => n,Verbose(,Vai ligar para ${EXTEN})
    same => n,SayDigits(${EXTEN})
    same => n,Dial(${Islas}/94,20)
    same => n,Hangup()

;
;	130 	salao de festas malhorca
;
exten => 130,1,NoOp(SalaoMalhorca)
    same => n,Verbose(,Ramal 130 ${EXTEN})
    same => n,SayDigits(${EXTEN})
    same => n,Dial(${Islas}/130,DAHDIDIALTIMEOUT)
    same => n,Hangup()

;
;	140	hall serviço malhorca 1S
;
exten => 140,1,NoOp(Malhorca1S)
    same => n,Verbose(,Ramal 140 ${EXTEN})
    same => n,SayDigits(${EXTEN})
    same => n,Dial(${Islas}/140,DAHDIDIALTIMEOUT)
    same => n,Hangup()

;
;	150 	hall serviço malhorca 2S
;
exten => 150,1,NoOp(SalaoMallorca)
    same => n,Verbose(,Ramal 150 ${EXTEN})
    same => n,SayDigits(${EXTEN})
    same => n,Dial(${Islas}/150,DAHDIDIALTIMEOUT)
    same => n,Hangup()

;
;	280 	hall social entrada 2S
;
exten => 280,1,NoOp(EntradaSocial)
    same => n,Verbose(,Ramal 280 ${EXTEN})
    same => n,SayDigits(${EXTEN})
    same => n,Dial(${Islas}/280,DAHDIDIALTIMEOUT)
    same => n,Hangup()

exten => _[12][123456789][12],1,NoOp(Torre 1 ou 2 de 11 a 91, 12 a 92)
    same => n,Verbose(,Ate o nono andar ISLAS)
    same => n,Verbose(,Vai ligar para ${EXTEN})
    same => n,SayDigits(${EXTEN})
    same => n,Dial(${Islas}/${EXTEN},30)

exten => _[12]1[0-9][12],1,NoOp(Torre 1 ou 2 de 101 a 191, 102 a 192)
    same => n,Verbose(,Entre o 10 e o 19 andar inclusive ISLAS)
    same => n,Verbose(,Vai ligar para ${EXTEN})
    same => n,SayDigits(${EXTEN})
    same => n,Dial(${Islas}/${EXTEN},30)
    same => n,Hangup()

exten => _[12]2[0123456][12],1,NoOp(Torre 1 ou 2 de 201 a 261, 202 a 262)
    same => n,Verbose(,Entre o 20 e o 26 andar inclusive ISLAS)
    same => n,Verbose(,Vai ligar para ${EXTEN})
    same => n,SayDigits(${EXTEN})
    same => n,Dial(${Islas}/${EXTEN},30)
    same => n,Hangup()






;============================================================
[RamaisInternos]
include => RotaLocal
include => RotaCelular
include => RotaTeste
;
; Ramais Internos: 4001 a 4004
;
exten => 4001,1,GoSub(subRamaisInternos,start,1(4001,DAHDI/5,30)
exten => 4002,1,GoSub(subRamaisInternos,start,1(4002,DAHDI/6,30)
exten => 4003,1,GoSub(subRamaisInternos,start,1(4003,DAHDI/7,30)
exten => 4004,1,GoSub(subRamaisInternos,start,1(4004,DAHDI/8,30)

;============================================================
[RamaisPJSIP]

exten => 50000,1,NoOp(Cel 970 750 000 - via PJSIP)
    same => n,Verbose(, Cel via PJSIP:970 750 000)
    same => n,Dial(PJSIP/50000,PJSIPDIALTIMEOUT)
    same => n,Hangup()

exten => 52001,1,NoOp(Cel 972 422 001 - via PJSIP)
    same => n,Verbose(, Cel via SIP:972 422 001)
    same => n,Dial(PJSIP/52001,PJSIPDIALTIMEOUT)
    same => n,Hangup()

; Plex
exten => 52002,1,NoOp(Plex PJSIP 52002)
    same => n,Verbose(, Plex PJSIP 52002)
    same => n,Dial(PJSIP/52002,PJSIPDIALTIMEOUT)
    same => n,Hangup()

; N8330
exten => 52003,1,NoOp(N8330 PJSIP 52003)
    same => n,Verbose(, N8330 PJSIP 52003)
    same => n,Dial(PJSIP/52003,SIPDIALTIMEOUT)
    same => n,Hangup()

; dv7
exten => 52004,1,NoOp(dv7 PJSIP 52004)
    same => n,Verbose(, dv7 PJSIP 52004)
    same => n,Dial(PJSIP/52004,SIPDIALTIMEOUT)
    same => n,Hangup()

; infoway
exten => 52005,1,NoOp(InfoWay PJSIP 52005)
    same => n,Verbose(, InfoWay PJSIP 52005)
    same => n,Dial(PJSIP/52005,PJSIPDIALTIMEOUT)
    same => n,Hangup()

; iPad
exten => 52006,1,NoOp(iPad PJSIP 52006)
    same => n,Verbose(, iPad PJSIP 52006)
    same => n,Dial(PJSIP/52006,PJSIPDIALTIMEOUT)
    same => n,Hangup()

;============================================================
[RamaisPJSIPR]

exten => 50010,1,NoOp(Cel 970 750 000 - via PJSIP)
    same => n,Verbose(, Cel via PJSIP:970 750 000)
    same => n,Dial(PJSIP/50010,PJSIPDIALTIMEOUT)
    same => n,Hangup()

exten => 52011,1,NoOp(Cel 972 422 001 - via PJSIP REMOTO)
    same => n,Verbose(, Cel via PJSIP REMOTO:972 422 001)
    same => n,Dial(PJSIP/52011,PJSIPDIALTIMEOUT)
    same => n,Hangup()

; Plex
exten => 52012,1,NoOp(Plex PJSIP REMOTO 52012)
    same => n,Verbose(, Plex PJSIP REMOTO 52012)
    same => n,Dial(PJSIP/52012,PJSIPDIALTIMEOUT)
    same => n,Hangup()

; N8330
exten => 52013,1,NoOp(N8330 PJSIP REMOTO 52013)
    same => n,Verbose(, N8330 PJSIP REMOTO 52013)
    same => n,Dial(PJSIP/52013,PJSIPDIALTIMEOUT)
    same => n,Hangup()

; dv7
exten => 52014,1,NoOp(dv7 PJSIP REMOTO 52014)
    same => n,Verbose(, dv7 PJSIP REMOTO 52014)
    same => n,Dial(PJSIP/52014,PJSIPDIALTIMEOUT)
    same => n,Hangup()

; infoway
exten => 52015,1,NoOp(InfoWay PJSIP REMOTO 52015)
    same => n,Verbose(, InfoWay PJSIP REMOTO 52015)
    same => n,Dial(PJSIP/52015,PJSIPDIALTIMEOUT)
    same => n,Hangup()

; iPad
exten => 52016,1,NoOp(iPad PJSIP REMOTO 52016)
    same => n,Verbose(, iPad PJSIP REMOTO 52016)
    same => n,Dial(PJSIP/52016,PJSIPDIALTIMEOUT)
    same => n,Hangup()

;============================================================
[RamaisIAX]

exten => 60000,1,NoOp(R60000: Note via IAX2 ${EXTEN})
    same => n,Verbose(,Note via IAX2 ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30)
    same => n,Hangup()

exten => 62001,1,NoOp(R62001: Lumia via IAX2)
    same => n,Verbose(,Lumia via IAX2 ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30)
    same => n,Hangup()

exten => 62003,1,NoOp(R62003: Infoway via IAX2)
    same => n,Verbose(,N8330 via IAX ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30,m)
    same => n,Hangup()

exten => 62004,1,NoOp(R62004: dv7 via IAX2)
    same => n,Verbose(,dv7 via IAX2 ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30,m)
    same => n,Hangup()

exten => 62005,1,NoOp(R62005: 8330 via IAX2)
    same => n,Verbose(,8330 via IAX2 ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30,m)
    same => n,Hangup()

exten => 62510,1,NoOp(R62510: Carlos via IAX2 ${EXTEN})
    same => n,Verbose(,Note via IAX2 ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30)
    same => n,Hangup()

exten => 63221,1,NoOp(Ramal 6 3221 Melissa via IAX2)
    same => n,Verbose(,Me via IAX2 ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30)
    same => n,Hangup()

exten => 63222,1,NoOp(Ramal 6 3222 Melissa via IAX2)
    same => n,Verbose(,Me via IAX2 ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30)
    same => n,Hangup()

exten => 64386,1,NoOp(R64386: Moto via IAX2 ${EXTEN})
    same => n,Verbose(,Note via IAX2 ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30)
    same => n,Hangup()

exten => 66384,1,NoOp(R66384: ferrari iPhone via IAX2)
    same => n,Verbose(,Ferrari iPhone via IAX2 ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30)
    same => n,Hangup()

exten => 68700,1,NoOp(R68700: Lumia via IAX2)
    same => n,Verbose(,Lumia via IAX2 ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30)
    same => n,Hangup()

exten => 61204,1,Verbose(2, 61204 MCM via ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30)
    same => n,Hangup()

exten => 69011,1,Verbose(2, 69011 Discovery11 via ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30)
    same => n,Hangup()
;============================================================
[internal]
include => Queues	; inclui as filas do Fixo e do Interfone
include => QueueFunctions	; inclui as funcoes de controle das filas
include => RamaisISLAS
include => RamaisInternos
include => RamaisPJSIP
include => RamaisPJSIPR
include => RamaisIAX

;
; Extensoes de teste
;

exten => 200,1,Set(CHANNEL(language)=br)
exten => 200,n,DateTime(now,,AHBdY)
exten => 200,n,MusicOnHold()
exten => 200,n,Wait(3)
exten => 200,n,Answer()
exten => 200,n,Playback(hello-world)
exten => 200,n,SayDigits(${EXTEN})
exten => 200,n,Hangup()

exten => 201,1,Goto(TestMenu,start,1)

exten => 202,1,NoOp(Teste 202)
	same => n,Playback(hello-world)
	same => n,Hangup()





;============================================================

exten	=> 300,1,NoOp()
	same => n,Set(MSGNUM=${DB(arfn/count)})
	same => n,GotoIf($[${ISNULL(${MSGNUM})}]?:continue)
	same => n,Verbose(1,Vai comecar a contar)
	same => n,Set(DB(arfn/count)=1)
	same => n,Goto(1)
	same => n(continue),NoOp()
	same => n,Verbose(1,[ ${MSGNUM} ])
	same => n,Set(MSGNUM=$[${MSGNUM} + 1])
	same => n,Playback(silence/1)
	same => n,SayNumber(${MSGNUM})
	same => n,Set(DB(arfn/count)=${MSGNUM})
	same => n,Playback(silence/1&vm-intro)
	same => n,Verbose(1,Gravando prompt${MSGNUM}.wav)
	same => n,Record(prompt${MSGNUM}.wav)
	same => n,Wait(2)
	same => n,Playback(prompt${MSGNUM})
	same => n,Goto(1)

exten		=> 301,1,NoOp()
	same	=> n,Wait(1)
	same	=> n,Read(PNUM,vm-intro,3)
	same	=> n,Verbose(1,Prompt: [prompt${PNUM}.wav])
	same	=> n,Set(x=${STAT(f,/var/lib/asterisk/sounds/prompt${PNUM}.wav)})
	same 	=> n,GotoIf($[${x}=1]?existe:naoexiste)
	same 	=> n(existe),SayDigits(${PNUM})
	same 	=> n,Playback(prompt${PNUM})
	same 	=> n,Goto(1)
	same	=> n(naoexiste),Playback(silence/1&enum-lookup-failed)
	same 	=> n,Goto(1)
	;same	=> n


;============================================================
exten => 500,1,Verbose(2,Echo test application)
	same => n,Playback(hello-world)
	same => n,Hangup()

;
; 	501:	Entra da fila
;	
exten => 501,1,Verbose(1,Via ${EXTEN}: Canal ${CHANNEL(channeltype)} entrando na fila em ${CHANNEL(peername)})
	same => n,GotoIf($[${CHANNEL(channeltype)} = DAHDI]?canal_DAHDI,1)
	same => n,GotoIf($[${CHANNEL(channeltype)} = PJSIP]?canal_PJSIP,1)
	same => n,GotoIf($[${CHANNEL(channeltype)} = IAX2]?canal_IAX,1)
	same => n,Verbose(2,Canal nao e DAHDI nem PJSIP nem IAX)
	same => n,Hangup()
	
exten => canal_IAX,1,Verbose(2,IAX)
	same => n,AddQueueMember(Fixo,${CHANNEL(channeltype)}/${CHANNEL(peername)})
	same => n,Verbose(2,Status AddQueueMember(Fixo) ${AQMSTATUS})
	same => n,AddQueueMember(Interfone,${CHANNEL(channeltype)}/${CHANNEL(peername)})
	same => n,Verbose(2,Status AddQueueMember(Interfone) ${AQMSTATUS})
        same => n,GotoIf($[${AQMSTATUS} = ADDED]?:a)

	same => n,Verbose(2,Adicionado ==> OK)
	same => n,Playback(silence/1&agent-loginok);
	same => n,Hangup()

        same => n(a),GotoIf($[${AQMSTATUS} = MEMBERALREADY]?:continue)
	same => n,Verbose(2,Ja atendendo ==> OK)
	same => n,Playback(silence/1&agent-alreadyon);

	same => n(continue),Hangup()
	
exten => canal_PJSIP,1,Verbose(2,PJSIP)
	same => n,AddQueueMember(Fixo,${CHANNEL(channeltype)}/${CHANNEL(peername)})
	same => n,Verbose(2,Status AddQueueMember(Fixo) ${AQMSTATUS})
	same => n,AddQueueMember(Interfone,${CHANNEL(channeltype)}/${CHANNEL(peername)})
	same => n,Verbose(2,Status AddQueueMember(Interfone) ${AQMSTATUS})
        same => n,GotoIf($[${AQMSTATUS} = ADDED]?:a)

	same => n,Verbose(2,Adicionado ==> OK)
	same => n,Playback(silence/1&agent-loginok);
	same => n,Hangup()

        same => n(a),GotoIf($[${AQMSTATUS} = MEMBERALREADY]?:continue)
	same => n,Verbose(2,Ja atendendo ==> OK)
	same => n,Playback(silence/1&agent-alreadyon);

	same => n(continue),Hangup()
	
exten => canal_DAHDI,1,Verbose(2,DAHDI)
	same => n,AddQueueMember(Fixo,${CHANNEL(channeltype)}/${CHANNEL(peername)})
	same => n,Verbose(2,Status AddQueueMember(Fixo) ${AQMSTATUS})
	same => n,AddQueueMember(Interfone,${CHANNEL(channeltype)}/${CHANNEL(peername)})
	same => n,Verbose(2,Status AddQueueMember(Interfone) ${AQMSTATUS})
        same => n,GotoIf($[${AQMSTATUS} = ADDED]?:a)

	same => n,Verbose(2,Adicionado ==> OK)
	same => n,Playback(silence/1&agent-loginok);
	same => n,Hangup()

        same => n(a),GotoIf($[${AQMSTATUS} = MEMBERALREADY]?:continue)
	same => n,Verbose(2,Ja atendendo ==> OK)
	same => n,Playback(silence/1&agent-alreadyon);

	same => n(continue),Hangup()

;
; 	502:	Sai da fila
;	

exten => 502,1,	Verbose(1,${EXTEN}:==> Removendo ${CHANNEL(name)} ${CHANNEL(channeltype)}/${CHANNEL(peername)} da fila)
	same => n,Verbose(2,Canal DAHDI=[${CHANNEL(dahdi_channel)}])
	same => n,GotoIf($[${CHANNEL(channeltype)} = DAHDI]?canal_DAHDI_R,1)
	same => n,GotoIf($[${CHANNEL(channeltype)} = PJSIP]?canal_SIP_R,1)
	same => n,GotoIf($[${CHANNEL(channeltype)} = IAX2]?canal_IAX_R,1)
	same => n,Verbose(2,Canal nao e DAHDI nem PJSIP nem IAX)
	same => n,Hangup()
	
exten => canal_IAX_R,1,Verbose(1,IAX Remove)
	same => n,RemoveQueueMember(Fixo,${CHANNEL(channeltype)}/${CHANNEL(peername)})
	same => n,RemoveQueueMember(Interfone,${CHANNEL(channeltype)}/${CHANNEL(peername)})
	same => n,Verbose(2,Status depois de RemoveQueueMember(Interfone) ${RQMSTATUS})
        same => n,GotoIf($[${RQMSTATUS} = REMOVED]?:continue)

	same => n,Verbose(2,Agente REMOVIDO ==> OK)
	same => n,Playback(silence/1&agent-loggedoff);
	same => n(continue),Hangup()
	
exten => canal_PJSIP_R,1,Verbose(1,PJSIP Remove)
	same => n,RemoveQueueMember(Fixo,${CHANNEL(channeltype)}/${CHANNEL(peername)})
	same => n,RemoveQueueMember(Interfone,${CHANNEL(channeltype)}/${CHANNEL(peername)})
	same => n,Verbose(2,Status depois de RemoveQueueMember(Interfone) ${RQMSTATUS})
        same => n,GotoIf($[${RQMSTATUS} = REMOVED]?:continue)

	same => n,Verbose(2,Agente REMOVIDO ==> OK)
	same => n,Playback(silence/1&agent-loggedoff);
	same => n(continue),Hangup()

exten => canal_DAHDI_R,1,Verbose(1,DAHDI Remove)
	same => n,RemoveQueueMember(Fixo,${CHANNEL(channeltype)}/${CHANNEL(peername)})
	same => n,RemoveQueueMember(Interfone,${CHANNEL(channeltype)}/${CHANNEL(peername)})
	same => n,Verbose(2,Status depois de RemoveQueueMember(Interfone) ${RQMSTATUS})
        same => n,GotoIf($[${RQMSTATUS} = REMOVED]?:continue)

	same => n,Verbose(2,Agente REMOVIDO ==> OK)
	same => n,Playback(silence/1&agent-loggedoff);
	same => n(continue),Hangup()

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;



;============================================================
exten => 555,hint,555
exten => 555,1,NoOp(555: Acesso ao Correio de VOZ)
    same => n,Verbose(,Acesso ao Correio de Voz)
    same => n,VoiceMailMain()
    same => n,Hangup()

;
; Telefones VOIP
;

exten => 599,hint,PJSIP-599
exten => 599,1,Verbose(,Ramal TIP-100 VOIP)
    same => n,Dial(${VOIPL},30)
    same => n,Hangup()

exten => 5999,hint,PJSIP-5999
exten => 5999,1,Verbose(,Ramal TIP-100 VOIP REMOTO)
    same => n,Dial(${VOIPR},30)
    same => n,Hangup()




exten => 664,1,Verbose(1,[${EXTEN}])
	same => n,Playback(hello-world)
	same => n,Playback(silence/1)
	same => n,Playback(agent-loginok)
	same => n,Playback(silence/1&hello-world)
	same => n,Playback(silence/1&agent-loginok)
	same => n,Hangup()

exten => 665,1,Verbose(1,[${EXTEN}])
	same 	=> n,Playback(silence/1&prompt53)
	same 	=> n,Verbose(1,testa se o servidor esta ligado)
	same 	=> n,System(/home/asterisk/teste.sh)
	same 	=> n,Verbose(1,Retorno do script: ${SYSTEMSTATUS})
	same	=> n,GotoIf($[${SYSTEMSTATUS}=SUCCESS]?sucesso:falha)
	same 	=> n(sucesso),Playback(silence/1&prompt36)
	same 	=> n,Verbose(1,servidor esta ligado)
	same 	=> n,Hangup()
	; desligado
	same => n(falha),NoOp()
	same => n,Playback(silence/1&prompt37)
	same => n,Verbose(1,servidor NAO esta ligado)
	;
	; 	Tecle 1 para ligar o servidor
	same	=> n,Read(ASW,prompt42&prompt54&beep,4)
	same	=> n,Verbose(1,Leu: [${ASW}])
	same 	=> n,GotoIf($[${ASW}=1]?liga:naoliga)
	same	=> n(liga),NoOp()
	same 	=> n,Verbose(1,Vai rodar server-on)
	same 	=> n,System(/home/asterisk/server-on.sh)
	same 	=> n,Verbose(1,Retorno de server-on: ${SYSTEMSTATUS})
	same	=> n,GotoIf($[${SYSTEMSTATUS}=SUCCESS]?script-ok:script-error)
	same	=> n(script-ok),NoOp()
	same 	=> n,Verbose(1, server-on ok. Aguarde)
	same 	=> n,Playback(silence/1&prompt47)
	same 	=> n,Hangup()
	same	=> n(script-error),NoOp()
	same 	=> n,Verbose(1, server-on falhou. Aguarde)
	same 	=> n,Playback(silence/1&prompt50)
	same 	=> n,Hangup()


exten => 666,1,Verbose(1,[${EXTEN}])
	same 	=> n,Verbose(1,Vai rodar server-on)
	same 	=> n,System(/home/asterisk/server-on.sh)
	same 	=> n,Verbose(1,Retorno de server-on: ${SYSTEMSTATUS})
	same 	=> n,Playback(silence/1)
	same 	=> n,Hangup()

;============================================================
[TestMenu]
exten => start,1,NoOp(:Menu de Teste)
    same => n,Verbose(,Vai atender em TestMenu)
    same => n,Answer()
    same => n,BackGround(main-menu)
    same => n,WaitExten(5)

exten => 1,1,Playback(digits/1)
    same => n,Goto(TestMenu,start,1)

exten => 2,1,Playback(digits/2)
    same => n,Goto(TestMenu,start,1)

exten => i,1,Playback(pbx-invalid)
    same => n,Goto(TestMenu,start,1)

exten => t,1,Playback(vm-goodbye)
    same => n,Goto(TestMenu,start,1)





;============================================================
[NETfone]
;
; linha 1 ligada ao modem da NET
;
exten => s,1,NoOp(Entrando em NETfone)
    same => n,Verbose(,NETfone)
    same => n,Verbose(,Chamada de [${CALLERID(all)}])
    same => n,Verbose(,Name <${CALLERID(name)}>)
    same => n,Verbose(,Num  <${CALLERID(num)}>)
    same => n,GotoIf($[${ISNULL(${CALLERID(name)})}]?:continue)
; se nao veio o nome, troca por "telefone"
    same => n,Set(CALLERID(name)=Telefone)
    same => n,Progress()
    same => n,MusicOnHold(,8)
    same => n(continue),Queue(Fixo,n,,,${QUEUETIMEOUT});
    same => n,VoiceMail(${MBOXFONE}@default,u)
    same => n,Hangup()

;============================================================
;
; menu original antes de se usar as filas
; era chamado com a linha abaixo
;
;   same => n,Goto(NETfoneMenu,start,1)
;
[NETfoneMenu]
exten => start,1,NoOp(:NETfone Menu)
    same => n,Verbose(,Vai atender NET fone)
    same => n,Verbose(,Chamada de [${CALLERID(all)}])
    same => n,Set(CALLERID(name)=Telefone)
    same => n,Set(CALLERID(num)=0000-0000)
    same => n,Dial(Local/ramal@GNET&Local/voip@GNET&Local/CelularA@GNET)
    same => n,Hangup()

[GNET]
exten => ramal,1,NoOp(Toca no ramal do escritorio)
    same => n,Verbose(,Toca no ramal do escritorio - ${Interfone})
    same => n,Dial(${Fone},30)
    same => n,Hangup()

exten => voip,1,NoOp(Toca no Intelbras VOIP)
    same => n,Verbose(,Espera 5s e toca no VOIP por 15s)
    same => n,Wait(3)
    same => n,Dial(${VOIP},30)
    same => n,Hangup()

exten => CelularA,1,NoOp(Toca no celular 0000 via iax)
    same => n,Verbose(,Espera 5s e toca no celular 0000 por 15s)
    same => n,Verbose(,Chamada de [${CALLERID(all)}])
    same => n,Wait(3)
    same => n,Dial(IAX2/60000,30)
    same => n,Hangup()

;============================================================
[IslasBaleares]
;
; linha 2 ligada ao PABX do predio
;
exten => s,1,Verbose(2,==>> Linha 2:IslasBaleares)
    same => n,Set(CALLERID(name)=Interfone Islas)
    same => n,Set(CALLERID(num)=XXXX)
;   same => n,Goto(IslasMenu,start,1)
    same => n,Progress()
    same => n,MusicOnHold(,8)
    same => n,Queue(Interfone,n,,,${QUEUETIMEOUT});
    same => n,VoiceMail(${MBOXISLAS}@default,u)
    same => n,Hangup()

;============================================================
[IslasMenu]
exten => start,1,NoOp(:Menu Islas)
    same => n,Verbose(,Vai atender em MenuIslas)
    same => n,Dial(Local/interfone@GIslas&Local/voip@GIslas&Local/CelularA@GIslas)
    same => n,Hangup()

[GIslas]
exten => interfone,1,NoOp(Toca no ramal do escritorio - interfone)
    same => n,Verbose(,Toca no ramal do escritorio - ${Interfone})
    same => n,Dial(${Interfone},20)
    same => n,Hangup()

exten => voip,1,NoOp(Toca no Intelbras VOIP)
    same => n,Verbose(,Espera 5s e toca no VOIP por 15s)
    same => n,Wait(1)
    same => n,Dial(${VOIP},30)
    same => n,Hangup()

exten => CelularA,1,NoOp(Toca no celular 0000 via iax)
    same => n,Verbose(,Espera 5s e toca no celular 0000 por 15s)
    same => n,Verbose(,Chamada de [${CALLERID(all)}])
    same => n,Wait(1)
    same => n,Dial(IAX2/60000,30)
    same => n,Hangup()





;============================================================
[RotaCelular]
;
; Rota externa para celulares 9XX-XXX-XXX
;
exten => _9NXXXXXXX,1,Verbose(1,Celular local: ${EXTEN} )
    same => n,SayDigits(${EXTEN})
    same => n,Dial(${NET}/${EXTEN},${DAHDIDIALTIMEOUT})
    same => n,Hangup()

;============================================================
[RotaLocal]
;
; Rota externa para Telefones locais comuns 
;
exten => _NXXXXXXX,1,NoOp(Fixo Local ou NEXTEL)
    same => n,Verbose(,Fixo local ou Nextel)
    same => n,Verbose(,Vai ligar para ${EXTEN})
    same => n,SayDigits(${EXTEN})
    same => n,Dial(${NET}/${EXTEN},30)
    same => n,Hangup()

;============================================================
[RotaTeste]
;
; Rotas de teste, 3 para Fixo 4 para PABX
;
exten => 3,1,NoOp(Ramal ${EXTEN})
    same => n,Set(CHANNEL(language)=br)
    same => n,Verbose(,com MusicOnHold, contexto PABX)
    same => n,GoTo(NETfone,s,1)

exten => 4,1,NoOp(Ramal ${EXTEN})
    same => n,Verbose(,com moh contexto Fone)
;   same => n,SetMusicOnHold(default)
;   same => n,WaitMusicOnHold(20)
NET=DAHDI/1
Islas=DAHDI/2
Interfone=DAHDI/5	; Ramal do interfone no escritorio
Fone=DAHDI/5		; Ramal do telefone no escritorio
VOIPL=PJSIP/599		; Intelbras VOIP via PJSIP LOCAL
VOIPR=PJSIP/5999		; Intelbras VOIP via PJSIP REMOTO
CelularA=IAX2/60000
;
; tempos de discagem
;
DAHDIDIALTIMEOUT=60
PJSIPDIALTIMEOUT=60
IAXDIALTIMEOUT=60

QUEUETIMEOUT=120		; Timeout a ser usado nas filas de atendimento
			; depois desse tempo as chamadas vao para o voice mail
MBOXFONE=4001
MBOXISLAS=4002

[general]
autofalltrough=yes
callcounter=yes

[default]

exten => s,1,NoOp(Entrando em default)
    same => n,Verbose(,default)
    same => n,Playback(hello-world)
    same => n,Playback(hello-world)
    same => n,Playback(hello-world)
    same => n,Hangup()





;============================================================
[ToBeDefined]
;
; para chamadas nao autenticadas via PJSIP: Buraco Negro
; 2016/jun
;




;============================================================
; sub()	arg1	extension
;	arg2	channel
;	arg3	dial timeout
;
[subRamaisInternos]
exten => start,1,NoOp(Ramal ${ARG1})
    same => n,Set(CHANNEL(language)=br)
    same => n,Verbose(,Chamando Ramal ${ARG1} por ${ARG3}s)
    same => n,Dial(${ARG2},${ARG3})
    same => n,Verbose(,Discagem falhou. Status = ${DIALSTATUS})
    same => n,VoiceMail(${ARG1}@default,u)
    same => n,Hangup()





;============================================================
[Queues]
exten => 7001,1,Verbose(2,${CALLERID(all)} entrando na fila "Interfone")
    same => n,Queue(Interfone,n,,,${QUEUETIMEOUT})
    same => n,VoiceMail(${MBOXISLAS}@default,u)
    same => n,Hangup()

exten => 7002,1,Verbose(2,${CALLERID(all)} entrando na fila "Fixo")
    same => n,Queue(Fixo,n,,,${QUEUETIMEOUT})
    same => n,VoiceMail(${MBOXFONE}@default,u)
    same => n,Hangup()





;============================================================
[RamaisISLAS]
;
; Ramais Islas: 1 para torre A 2 para torre B mais o numero do apartamento
;		11A = 111
;		101A = 1101
;		262A = 2262
;
exten => 044,1,NoOp(Zelador)
    same => n,Verbose(2,Zelador ${EXTEN})
    same => n,SayDigits(${EXTEN})
    same => n,Dial(${Islas}/${EXTEN},20)
    same => n,Hangup()
 
exten => 94,1,NoOp(Portaria)
    same => n,Verbose(,Vai ligar na portaria via ${EXTEN})
    same => n,Verbose(,Vai ligar para ${EXTEN})
    same => n,SayDigits(${EXTEN})
    same => n,Dial(${Islas}/94,20)
    same => n,Hangup()

;
;	130 	salao de festas malhorca
;
exten => 130,1,NoOp(SalaoMalhorca)
    same => n,Verbose(,Ramal 130 ${EXTEN})
    same => n,SayDigits(${EXTEN})
    same => n,Dial(${Islas}/130,DAHDIDIALTIMEOUT)
    same => n,Hangup()

;
;	140	hall serviço malhorca 1S
;
exten => 140,1,NoOp(Malhorca1S)
    same => n,Verbose(,Ramal 140 ${EXTEN})
    same => n,SayDigits(${EXTEN})
    same => n,Dial(${Islas}/140,DAHDIDIALTIMEOUT)
    same => n,Hangup()

;
;	150 	hall serviço malhorca 2S
;
exten => 150,1,NoOp(SalaoMallorca)
    same => n,Verbose(,Ramal 150 ${EXTEN})
    same => n,SayDigits(${EXTEN})
    same => n,Dial(${Islas}/150,DAHDIDIALTIMEOUT)
    same => n,Hangup()

;
;	280 	hall social entrada 2S
;
exten => 280,1,NoOp(EntradaSocial)
    same => n,Verbose(,Ramal 280 ${EXTEN})
    same => n,SayDigits(${EXTEN})
    same => n,Dial(${Islas}/280,DAHDIDIALTIMEOUT)
    same => n,Hangup()

exten => _[12][123456789][12],1,NoOp(Torre 1 ou 2 de 11 a 91, 12 a 92)
    same => n,Verbose(,Ate o nono andar ISLAS)
    same => n,Verbose(,Vai ligar para ${EXTEN})
    same => n,SayDigits(${EXTEN})
    same => n,Dial(${Islas}/${EXTEN},30)

exten => _[12]1[0-9][12],1,NoOp(Torre 1 ou 2 de 101 a 191, 102 a 192)
    same => n,Verbose(,Entre o 10 e o 19 andar inclusive ISLAS)
    same => n,Verbose(,Vai ligar para ${EXTEN})
    same => n,SayDigits(${EXTEN})
    same => n,Dial(${Islas}/${EXTEN},30)
    same => n,Hangup()

exten => _[12]2[0123456][12],1,NoOp(Torre 1 ou 2 de 201 a 261, 202 a 262)
    same => n,Verbose(,Entre o 20 e o 26 andar inclusive ISLAS)
    same => n,Verbose(,Vai ligar para ${EXTEN})
    same => n,SayDigits(${EXTEN})
    same => n,Dial(${Islas}/${EXTEN},30)
    same => n,Hangup()






;============================================================
[RamaisInternos]
include => RotaLocal
include => RotaCelular
include => RotaTeste
;
; Ramais Internos: 4001 a 4004
;
exten => 4001,1,GoSub(subRamaisInternos,start,1(4001,DAHDI/5,30)
exten => 4002,1,GoSub(subRamaisInternos,start,1(4002,DAHDI/6,30)
exten => 4003,1,GoSub(subRamaisInternos,start,1(4003,DAHDI/7,30)
exten => 4004,1,GoSub(subRamaisInternos,start,1(4004,DAHDI/8,30)

;============================================================
[RamaisPJSIP]

exten => 50000,1,NoOp(Cel 970 750 000 - via PJSIP)
    same => n,Verbose(, Cel via PJSIP:970 750 000)
    same => n,Dial(PJSIP/50000,PJSIPDIALTIMEOUT)
    same => n,Hangup()

exten => 52001,1,NoOp(Cel 972 422 001 - via PJSIP)
    same => n,Verbose(, Cel via PJSIP:972 422 001)
    same => n,Dial(PJSIP/52001,PJSIPDIALTIMEOUT)
    same => n,Hangup()

; Plex
exten => 52002,1,NoOp(Plex PJSIP 52002)
    same => n,Verbose(, Plex PJSIP 52002)
    same => n,Dial(PJSIP/52002,PJSIPDIALTIMEOUT)
    same => n,Hangup()

; N8330
exten => 52003,1,NoOp(N8330 PJSIP 52003)
    same => n,Verbose(, N8330 PJSIP 52003)
    same => n,Dial(PJSIP/52003,PJSIPDIALTIMEOUT)
    same => n,Hangup()

; dv7
exten => 52004,1,NoOp(dv7 PJSIP 52004)
    same => n,Verbose(, dv7 PJSIP 52004)
    same => n,Dial(PJSIP/52004,PJSIPDIALTIMEOUT)
    same => n,Hangup()

; infoway
exten => 52005,1,NoOp(InfoWay PJSIP 52005)
    same => n,Verbose(, InfoWay PJSIP 52005)
    same => n,Dial(PJSIP/52005,PJSIPDIALTIMEOUT)
    same => n,Hangup()

; iPad
exten => 52006,1,NoOp(iPad PJSIP 52006)
    same => n,Verbose(, iPad PJSIP 52006)
    same => n,Dial(PJSIP/52006,PJSIPDIALTIMEOUT)
    same => n,Hangup()

;============================================================
[RamaisPJSIPR]

exten => 50010,1,NoOp(Cel 970 750 000 - via PJSIP)
    same => n,Verbose(, Cel via PJSIP:970 750 000)
    same => n,Dial(PJSIP/50010,PJSIPDIALTIMEOUT)
    same => n,Hangup()

exten => 52011,1,NoOp(Cel 972 422 001 - via PJSIP REMOTO)
    same => n,Verbose(, Cel via PJSIP REMOTO:972 422 001)
    same => n,Dial(PJSIP/52011,PJSIPDIALTIMEOUT)
    same => n,Hangup()

; Plex
exten => 52012,1,NoOp(Plex PJSIP REMOTO 52012)
    same => n,Verbose(, Plex PJSIP REMOTO 52012)
    same => n,Dial(PJSIP/52012,PJSIPDIALTIMEOUT)
    same => n,Hangup()

; N8330
exten => 52013,1,NoOp(N8330 PJSIP REMOTO 52013)
    same => n,Verbose(, N8330 PJSIP REMOTO 52013)
    same => n,Dial(PJSIP/52013,PJSIPDIALTIMEOUT)
    same => n,Hangup()

; dv7
exten => 52014,1,NoOp(dv7 PJSIP REMOTO 52014)
    same => n,Verbose(, dv7 PJSIP REMOTO 52014)
    same => n,Dial(PJSIP/52014,PJSIPDIALTIMEOUT)
    same => n,Hangup()

; infoway
exten => 52015,1,NoOp(InfoWay PJSIP REMOTO 52015)
    same => n,Verbose(, InfoWay PJSIP REMOTO 52015)
    same => n,Dial(PJSIP/52015,PJSIPDIALTIMEOUT)
    same => n,Hangup()

; iPad
exten => 52016,1,NoOp(iPad PJSIP REMOTO 52016)
    same => n,Verbose(, iPad PJSIP REMOTO 52016)
    same => n,Dial(PJSIP/52016,PJSIPDIALTIMEOUT)
    same => n,Hangup()

;============================================================
[RamaisIAX]

exten => 60000,1,NoOp(R60000: Note via IAX2 ${EXTEN})
    same => n,Verbose(,Note via IAX2 ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30)
    same => n,Hangup()

exten => 62001,1,NoOp(R62001: Lumia via IAX2)
    same => n,Verbose(,Lumia via IAX2 ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30)
    same => n,Hangup()

exten => 62003,1,NoOp(R62003: Infoway via IAX2)
    same => n,Verbose(,N8330 via IAX ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30,m)
    same => n,Hangup()

exten => 62004,1,NoOp(R62004: dv7 via IAX2)
    same => n,Verbose(,dv7 via IAX2 ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30,m)
    same => n,Hangup()

exten => 62005,1,NoOp(R62005: 8330 via IAX2)
    same => n,Verbose(,8330 via IAX2 ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30,m)
    same => n,Hangup()

exten => 62510,1,NoOp(R62510: Carlos via IAX2 ${EXTEN})
    same => n,Verbose(,Note via IAX2 ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30)
    same => n,Hangup()

exten => 63221,1,NoOp(Ramal 6 3221 Melissa via IAX2)
    same => n,Verbose(,Me via IAX2 ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30)
    same => n,Hangup()

exten => 63222,1,NoOp(Ramal 6 3222 Melissa via IAX2)
    same => n,Verbose(,Me via IAX2 ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30)
    same => n,Hangup()

exten => 64386,1,NoOp(R64386: Moto via IAX2 ${EXTEN})
    same => n,Verbose(,Note via IAX2 ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30)
    same => n,Hangup()

exten => 66384,1,NoOp(R66384: ferrari iPhone via IAX2)
    same => n,Verbose(,Ferrari iPhone via IAX2 ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30)
    same => n,Hangup()

exten => 68700,1,NoOp(R68700: Lumia via IAX2)
    same => n,Verbose(,Lumia via IAX2 ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30)
    same => n,Hangup()

exten => 61204,1,Verbose(2, 61204 MCM via ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30)
    same => n,Hangup()

exten => 69011,1,Verbose(2, 69011 Discovery11 via ${EXTEN})
    same => n,Wait(1)
    same => n,Dial(IAX2/${EXTEN},30)
    same => n,Hangup()
;============================================================
[internal]
include => Queues	; inclui as filas do Fixo e do Interfone
include => QueueFunctions	; inclui as funcoes de controle das filas
include => RamaisISLAS
include => RamaisInternos
include => RamaisPJSIP
include => RamaisPJSIPR
include => RamaisIAX

;
; Extensoes de teste
;

exten => 200,1,Set(CHANNEL(language)=br)
exten => 200,n,DateTime(now,,AHBdY)
exten => 200,n,MusicOnHold()
exten => 200,n,Wait(3)
exten => 200,n,Answer()
exten => 200,n,Playback(hello-world)
exten => 200,n,SayDigits(${EXTEN})
exten => 200,n,Hangup()

exten => 201,1,Goto(TestMenu,start,1)

exten => 202,1,NoOp(Teste 202)
	same => n,Playback(hello-world)
	same => n,Hangup()





;============================================================

exten	=> 300,1,NoOp()
	same => n,Set(MSGNUM=${DB(arfn/count)})
	same => n,GotoIf($[${ISNULL(${MSGNUM})}]?:continue)
	same => n,Verbose(1,Vai comecar a contar)
	same => n,Set(DB(arfn/count)=1)
	same => n,Goto(1)
	same => n(continue),NoOp()
	same => n,Verbose(1,[ ${MSGNUM} ])
	same => n,Set(MSGNUM=$[${MSGNUM} + 1])
	same => n,Playback(silence/1)
	same => n,SayNumber(${MSGNUM})
	same => n,Set(DB(arfn/count)=${MSGNUM})
	same => n,Playback(silence/1&vm-intro)
	same => n,Verbose(1,Gravando prompt${MSGNUM}.wav)
	same => n,Record(prompt${MSGNUM}.wav)
	same => n,Wait(2)
	same => n,Playback(prompt${MSGNUM})
	same => n,Goto(1)

exten		=> 301,1,NoOp()
	same	=> n,Wait(1)
	same	=> n,Read(PNUM,vm-intro,3)
	same	=> n,Verbose(1,Prompt: [prompt${PNUM}.wav])
	same	=> n,Set(x=${STAT(f,/var/lib/asterisk/sounds/prompt${PNUM}.wav)})
	same 	=> n,GotoIf($[${x}=1]?existe:naoexiste)
	same 	=> n(existe),SayDigits(${PNUM})
	same 	=> n,Playback(prompt${PNUM})
	same 	=> n,Goto(1)
	same	=> n(naoexiste),Playback(silence/1&enum-lookup-failed)
	same 	=> n,Goto(1)
	;same	=> n


;============================================================
exten => 500,1,Verbose(2,Echo test application)
	same => n,Playback(hello-world)
	same => n,Hangup()

;
; 	501:	Entra da fila
;	
exten => 501,1,Verbose(1,Via ${EXTEN}: Canal ${CHANNEL(channeltype)} entrando na fila em ${CHANNEL(peername)})
	same => n,GotoIf($[${CHANNEL(channeltype)} = DAHDI]?canal_DAHDI,1)
	same => n,GotoIf($[${CHANNEL(channeltype)} = PJSIP]?canal_PJSIP,1)
	same => n,GotoIf($[${CHANNEL(channeltype)} = IAX2]?canal_IAX,1)
	same => n,Verbose(2,Canal nao e DAHDI nem PJSIP nem IAX)
	same => n,Hangup()
	
exten => canal_IAX,1,Verbose(2,IAX)
	same => n,AddQueueMember(Fixo,${CHANNEL(channeltype)}/${CHANNEL(peername)})
	same => n,Verbose(2,Status AddQueueMember(Fixo) ${AQMSTATUS})
	same => n,AddQueueMember(Interfone,${CHANNEL(channeltype)}/${CHANNEL(peername)})
	same => n,Verbose(2,Status AddQueueMember(Interfone) ${AQMSTATUS})
        same => n,GotoIf($[${AQMSTATUS} = ADDED]?:a)

	same => n,Verbose(2,Adicionado ==> OK)
	same => n,Playback(silence/1&agent-loginok);
	same => n,Hangup()

        same => n(a),GotoIf($[${AQMSTATUS} = MEMBERALREADY]?:continue)
	same => n,Verbose(2,Ja atendendo ==> OK)
	same => n,Playback(silence/1&agent-alreadyon);

	same => n(continue),Hangup()
	
exten => canal_PJSIP,1,Verbose(2,PJSIP)
	same => n,AddQueueMember(Fixo,${CHANNEL(channeltype)}/${CHANNEL(peername)})
	same => n,Verbose(2,Status AddQueueMember(Fixo) ${AQMSTATUS})
	same => n,AddQueueMember(Interfone,${CHANNEL(channeltype)}/${CHANNEL(peername)})
	same => n,Verbose(2,Status AddQueueMember(Interfone) ${AQMSTATUS})
        same => n,GotoIf($[${AQMSTATUS} = ADDED]?:a)

	same => n,Verbose(2,Adicionado ==> OK)
	same => n,Playback(silence/1&agent-loginok);
	same => n,Hangup()

        same => n(a),GotoIf($[${AQMSTATUS} = MEMBERALREADY]?:continue)
	same => n,Verbose(2,Ja atendendo ==> OK)
	same => n,Playback(silence/1&agent-alreadyon);

	same => n(continue),Hangup()
	
exten => canal_DAHDI,1,Verbose(2,DAHDI)
	same => n,AddQueueMember(Fixo,${CHANNEL(channeltype)}/${CHANNEL(peername)})
	same => n,Verbose(2,Status AddQueueMember(Fixo) ${AQMSTATUS})
	same => n,AddQueueMember(Interfone,${CHANNEL(channeltype)}/${CHANNEL(peername)})
	same => n,Verbose(2,Status AddQueueMember(Interfone) ${AQMSTATUS})
        same => n,GotoIf($[${AQMSTATUS} = ADDED]?:a)

	same => n,Verbose(2,Adicionado ==> OK)
	same => n,Playback(silence/1&agent-loginok);
	same => n,Hangup()

        same => n(a),GotoIf($[${AQMSTATUS} = MEMBERALREADY]?:continue)
	same => n,Verbose(2,Ja atendendo ==> OK)
	same => n,Playback(silence/1&agent-alreadyon);

	same => n(continue),Hangup()

;
; 	502:	Sai da fila
;	

exten => 502,1,	Verbose(1,${EXTEN}:==> Removendo ${CHANNEL(name)} ${CHANNEL(channeltype)}/${CHANNEL(peername)} da fila)
	same => n,Verbose(2,Canal DAHDI=[${CHANNEL(dahdi_channel)}])
	same => n,GotoIf($[${CHANNEL(channeltype)} = DAHDI]?canal_DAHDI_R,1)
	same => n,GotoIf($[${CHANNEL(channeltype)} = PJSIP]?canal_PJSIP_R,1)
	same => n,GotoIf($[${CHANNEL(channeltype)} = IAX2]?canal_IAX_R,1)
	same => n,Verbose(2,Canal nao e DAHDI nem PJSIP nem IAX)
	same => n,Hangup()
	
exten => canal_IAX_R,1,Verbose(1,IAX Remove)
	same => n,RemoveQueueMember(Fixo,${CHANNEL(channeltype)}/${CHANNEL(peername)})
	same => n,RemoveQueueMember(Interfone,${CHANNEL(channeltype)}/${CHANNEL(peername)})
	same => n,Verbose(2,Status depois de RemoveQueueMember(Interfone) ${RQMSTATUS})
        same => n,GotoIf($[${RQMSTATUS} = REMOVED]?:continue)

	same => n,Verbose(2,Agente REMOVIDO ==> OK)
	same => n,Playback(silence/1&agent-loggedoff);
	same => n(continue),Hangup()
	
exten => canal_PJSIP_R,1,Verbose(1,PJSIP Remove)
	same => n,RemoveQueueMember(Fixo,${CHANNEL(channeltype)}/${CHANNEL(peername)})
	same => n,RemoveQueueMember(Interfone,${CHANNEL(channeltype)}/${CHANNEL(peername)})
	same => n,Verbose(2,Status depois de RemoveQueueMember(Interfone) ${RQMSTATUS})
        same => n,GotoIf($[${RQMSTATUS} = REMOVED]?:continue)

	same => n,Verbose(2,Agente REMOVIDO ==> OK)
	same => n,Playback(silence/1&agent-loggedoff);
	same => n(continue),Hangup()

exten => canal_DAHDI_R,1,Verbose(1,DAHDI Remove)
	same => n,RemoveQueueMember(Fixo,${CHANNEL(channeltype)}/${CHANNEL(peername)})
	same => n,RemoveQueueMember(Interfone,${CHANNEL(channeltype)}/${CHANNEL(peername)})
	same => n,Verbose(2,Status depois de RemoveQueueMember(Interfone) ${RQMSTATUS})
        same => n,GotoIf($[${RQMSTATUS} = REMOVED]?:continue)

	same => n,Verbose(2,Agente REMOVIDO ==> OK)
	same => n,Playback(silence/1&agent-loggedoff);
	same => n(continue),Hangup()

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;



;============================================================
exten => 555,hint,555
exten => 555,1,NoOp(555: Acesso ao Correio de VOZ)
    same => n,Verbose(,Acesso ao Correio de Voz)
    same => n,VoiceMailMain()
    same => n,Hangup()

;
; Telefones VOIP
;

exten => 599,hint,PJSIP-599
exten => 599,1,Verbose(,Ramal TIP-100 VOIP)
    same => n,Dial(${VOIPL},30)
    same => n,Hangup()

exten => 5999,hint,PJSIP-5999
exten => 5999,1,Verbose(,Ramal TIP-100 VOIP REMOTO)
    same => n,Dial(${VOIPR},30)
    same => n,Hangup()




exten => 664,1,Verbose(1,[${EXTEN}])
	same => n,Playback(hello-world)
	same => n,Playback(silence/1)
	same => n,Playback(agent-loginok)
	same => n,Playback(silence/1&hello-world)
	same => n,Playback(silence/1&agent-loginok)
	same => n,Hangup()

exten => 665,1,Verbose(1,[${EXTEN}])
	same 	=> n,Playback(silence/1&prompt53)
	same 	=> n,Verbose(1,testa se o servidor esta ligado)
	same 	=> n,System(/home/asterisk/teste.sh)
	same 	=> n,Verbose(1,Retorno do script: ${SYSTEMSTATUS})
	same	=> n,GotoIf($[${SYSTEMSTATUS}=SUCCESS]?sucesso:falha)
	same 	=> n(sucesso),Playback(silence/1&prompt36)
	same 	=> n,Verbose(1,servidor esta ligado)
	same 	=> n,Hangup()
	; desligado
	same => n(falha),NoOp()
	same => n,Playback(silence/1&prompt37)
	same => n,Verbose(1,servidor NAO esta ligado)
	;
	; 	Tecle 1 para ligar o servidor
	same	=> n,Read(ASW,prompt42&prompt54&beep,4)
	same	=> n,Verbose(1,Leu: [${ASW}])
	same 	=> n,GotoIf($[${ASW}=1]?liga:naoliga)
	same	=> n(liga),NoOp()
	same 	=> n,Verbose(1,Vai rodar server-on)
	same 	=> n,System(/home/asterisk/server-on.sh)
	same 	=> n,Verbose(1,Retorno de server-on: ${SYSTEMSTATUS})
	same	=> n,GotoIf($[${SYSTEMSTATUS}=SUCCESS]?script-ok:script-error)
	same	=> n(script-ok),NoOp()
	same 	=> n,Verbose(1, server-on ok. Aguarde)
	same 	=> n,Playback(silence/1&prompt47)
	same 	=> n,Hangup()
	same	=> n(script-error),NoOp()
	same 	=> n,Verbose(1, server-on falhou. Aguarde)
	same 	=> n,Playback(silence/1&prompt50)
	same 	=> n,Hangup()


exten => 666,1,Verbose(1,[${EXTEN}])
	same 	=> n,Verbose(1,Vai rodar server-on)
	same 	=> n,System(/home/asterisk/server-on.sh)
	same 	=> n,Verbose(1,Retorno de server-on: ${SYSTEMSTATUS})
	same 	=> n,Playback(silence/1)
	same 	=> n,Hangup()

;============================================================
[TestMenu]
exten => start,1,NoOp(:Menu de Teste)
    same => n,Verbose(,Vai atender em TestMenu)
    same => n,Answer()
    same => n,BackGround(main-menu)
    same => n,WaitExten(5)

exten => 1,1,Playback(digits/1)
    same => n,Goto(TestMenu,start,1)

exten => 2,1,Playback(digits/2)
    same => n,Goto(TestMenu,start,1)

exten => i,1,Playback(pbx-invalid)
    same => n,Goto(TestMenu,start,1)

exten => t,1,Playback(vm-goodbye)
    same => n,Goto(TestMenu,start,1)





;============================================================
[NETfone]
;
; linha 1 ligada ao modem da NET
;
exten => s,1,NoOp(Entrando em NETfone)
    same => n,Verbose(,NETfone)
    same => n,Verbose(,Chamada de [${CALLERID(all)}])
    same => n,Verbose(,Name <${CALLERID(name)}>)
    same => n,Verbose(,Num  <${CALLERID(num)}>)
    same => n,GotoIf($[${ISNULL(${CALLERID(name)})}]?:continue)
; se nao veio o nome, troca por "telefone"
    same => n,Set(CALLERID(name)=Telefone)
    same => n,Progress()
    same => n,MusicOnHold(,8)
    same => n(continue),Queue(Fixo,n,,,${QUEUETIMEOUT});
    same => n,VoiceMail(${MBOXFONE}@default,u)
    same => n,Hangup()

;============================================================
;
; menu original antes de se usar as filas
; era chamado com a linha abaixo
;
;   same => n,Goto(NETfoneMenu,start,1)
;
[NETfoneMenu]
exten => start,1,NoOp(:NETfone Menu)
    same => n,Verbose(,Vai atender NET fone)
    same => n,Verbose(,Chamada de [${CALLERID(all)}])
    same => n,Set(CALLERID(name)=Telefone)
    same => n,Set(CALLERID(num)=0000-0000)
    same => n,Dial(Local/ramal@GNET&Local/voip@GNET&Local/CelularA@GNET)
    same => n,Hangup()

[GNET]
exten => ramal,1,NoOp(Toca no ramal do escritorio)
    same => n,Verbose(,Toca no ramal do escritorio - ${Interfone})
    same => n,Dial(${Fone},30)
    same => n,Hangup()

exten => voip,1,NoOp(Toca no Intelbras VOIP)
    same => n,Verbose(,Espera 5s e toca no VOIP por 15s)
    same => n,Wait(3)
    same => n,Dial(${VOIP},30)
    same => n,Hangup()

exten => CelularA,1,NoOp(Toca no celular 0000 via iax)
    same => n,Verbose(,Espera 5s e toca no celular 0000 por 15s)
    same => n,Verbose(,Chamada de [${CALLERID(all)}])
    same => n,Wait(3)
    same => n,Dial(IAX2/60000,30)
    same => n,Hangup()

;============================================================
[IslasBaleares]
;
; linha 2 ligada ao PABX do predio
;
exten => s,1,Verbose(2,==>> Linha 2:IslasBaleares)
    same => n,Set(CALLERID(name)=Interfone Islas)
    same => n,Set(CALLERID(num)=XXXX)
;   same => n,Goto(IslasMenu,start,1)
    same => n,Progress()
    same => n,MusicOnHold(,8)
    same => n,Queue(Interfone,n,,,${QUEUETIMEOUT});
    same => n,VoiceMail(${MBOXISLAS}@default,u)
    same => n,Hangup()

;============================================================
[IslasMenu]
exten => start,1,NoOp(:Menu Islas)
    same => n,Verbose(,Vai atender em MenuIslas)
    same => n,Dial(Local/interfone@GIslas&Local/voip@GIslas&Local/CelularA@GIslas)
    same => n,Hangup()

[GIslas]
exten => interfone,1,NoOp(Toca no ramal do escritorio - interfone)
    same => n,Verbose(,Toca no ramal do escritorio - ${Interfone})
    same => n,Dial(${Interfone},20)
    same => n,Hangup()

exten => voip,1,NoOp(Toca no Intelbras VOIP)
    same => n,Verbose(,Espera 5s e toca no VOIP por 15s)
    same => n,Wait(1)
    same => n,Dial(${VOIP},30)
    same => n,Hangup()

exten => CelularA,1,NoOp(Toca no celular 0000 via iax)
    same => n,Verbose(,Espera 5s e toca no celular 0000 por 15s)
    same => n,Verbose(,Chamada de [${CALLERID(all)}])
    same => n,Wait(1)
    same => n,Dial(IAX2/60000,30)
    same => n,Hangup()





;============================================================
[RotaCelular]
;
; Rota externa para celulares 9XX-XXX-XXX
;
exten => _9NXXXXXXX,1,Verbose(1,Celular local: ${EXTEN} )
    same => n,SayDigits(${EXTEN})
    same => n,Dial(${NET}/${EXTEN},${DAHDIDIALTIMEOUT})
    same => n,Hangup()

;============================================================
[RotaLocal]
;
; Rota externa para Telefones locais comuns 
;
exten => _NXXXXXXX,1,NoOp(Fixo Local ou NEXTEL)
    same => n,Verbose(,Fixo local ou Nextel)
    same => n,Verbose(,Vai ligar para ${EXTEN})
    same => n,SayDigits(${EXTEN})
    same => n,Dial(${NET}/${EXTEN},30)
    same => n,Hangup()

;============================================================
[RotaTeste]
;
; Rotas de teste, 3 para Fixo 4 para PABX
;
exten => 3,1,NoOp(Ramal ${EXTEN})
    same => n,Set(CHANNEL(language)=br)
    same => n,Verbose(,com MusicOnHold, contexto PABX)
    same => n,GoTo(NETfone,s,1)

exten => 4,1,NoOp(Ramal ${EXTEN})
    same => n,Verbose(,com moh contexto Fone)
;   same => n,SetMusicOnHold(default)
;   same => n,WaitMusicOnHold(20)
